version: '3'
services:
    otel-collector:
        image: otel/opentelemetry-collector-contrib:0.82.0
        restart: always
        command:
            - --config=/etc/otelcol-contrib/otel-collector.yml
        volumes:
            - ./docker/collector/otel-collector.yml:/etc/otelcol-contrib/otel-collector.yml
        ports:
            - "1888:1888" # pprof extension
            - "8888:8888" # Prometheus metrics exposed by the collector
            - "8889:8889" # Prometheus exporter metrics
            - "13133:13133" # health_check extension
            - "4317:4317" # OTLP gRPC receiver
            - "4318:4318" # OTLP http receiver
            - "55679:55679" # zpages extension
        depends_on:
            - jaeger-all-in-one
            - zipkin-all-in-one

    prometheus:
        container_name: prometheus
        image: prom/prometheus
        restart: always
        command:
            - --config.file=/etc/prometheus/prometheus.yml
        volumes:
            - ./docker/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
        ports:
            - "9090:9090"

    grafana:
        container_name: grafana
        image: grafana/grafana
        ports:
            - "3000:3000"

    # Jaeger
    jaeger-all-in-one:
        image: jaegertracing/all-in-one:latest
        restart: always
        ports:
            - "16686:16686"
            - "14268"
            - "14250"

    # Zipkin
#    zipkin-all-in-one:
#        image: openzipkin/zipkin:latest
#        restart: always
#        ports:
#            - "9411:9411"
    kafka:
        image: 'bitnami/kafka:3.7.0'
        container_name: kafka
        hostname: kafka
        ports:
            - '9094:9094'
        environment:
            - KAFKA_CFG_NODE_ID=0
            - KAFKA_CFG_PROCESS_ROLES=controller,broker
            - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093
            - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093,EXTERNAL://:9094
            - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092,EXTERNAL://localhost:9094
            - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,EXTERNAL:PLAINTEXT,PLAINTEXT:PLAINTEXT
            - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
    redis:
        image: redislabs/redismod
        ports:
            - 6379:6379
    redisinsight:
        image: redislabs/redisinsight:latest
        ports:
            - '5540:5540'
        volumes:
            - ./Users/ajeetraina/data/redisinsight:/db